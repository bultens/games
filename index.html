<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Game</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #2c3e50;
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        #game-container {
            position: relative;
            background-color: #34495e;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        canvas {
            background-color: #2c3e50;
            border: 3px solid #7f8c8d;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 400px;
            height: auto;
            aspect-ratio: 1 / 1;
        }

        #score-container {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f1c40f;
        }

        button {
            padding: 12px 25px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
            background-color: #3498db;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <h1>Snake</h1>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="score-container">Poäng: <span id="score">0</span></div>
        <button id="startButton">Starta spel</button>
    </div>

    <script>
        // Game constants
        const CANVAS_SIZE = 400; // Total canvas size in pixels
        const GRID_SIZE = 20; // Number of grid cells (e.g., 20x20)
        const CELL_SIZE = CANVAS_SIZE / GRID_SIZE; // Size of each cell
        const INITIAL_SPEED = 150; // Initial game speed in milliseconds (lower is faster)
        const SPEED_INCREMENT = 5; // How much to decrease the speed each time the snake eats

        // Game state variables
        let snake = [];
        let food = {};
        let direction = { x: 0, y: 0 };
        let score = 0;
        let gameSpeed = INITIAL_SPEED;
        let gameLoop = null;
        let isGameOver = false;
        let isGameStarted = false;

        // Get DOM elements
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const startButton = document.getElementById('startButton');

        // Set up the canvas dimensions
        canvas.width = CANVAS_SIZE;
        canvas.height = CANVAS_SIZE;

        // --- Game Logic Functions ---

        // Initialize the game state
        function initializeGame() {
            snake = [{ x: 10, y: 10 }]; // Start with one snake segment in the center
            food = generateFood();
            direction = { x: 0, y: 0 };
            score = 0;
            gameSpeed = INITIAL_SPEED;
            isGameOver = false;
            isGameStarted = false;
            scoreElement.innerText = score;
            startButton.innerText = 'Starta spel';
            render();
        }

        // Generate new food at a random position
        function generateFood() {
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * GRID_SIZE),
                    y: Math.floor(Math.random() * GRID_SIZE)
                };
            } while (isPositionOnSnake(newFood)); // Ensure food doesn't spawn on the snake
            return newFood;
        }

        // Check if a given position is on the snake's body
        function isPositionOnSnake(pos) {
            return snake.some(segment => segment.x === pos.x && segment.y === pos.y);
        }

        // Main game update function (called in a loop)
        function update() {
            if (isGameOver) {
                return;
            }

            // Move the snake by creating a new head
            const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

            // Check for game over conditions
            if (
                head.x < 0 || head.x >= GRID_SIZE || // Wall collision
                head.y < 0 || head.y >= GRID_SIZE ||
                isPositionOnSnake(head) // Self collision
            ) {
                endGame();
                return;
            }

            // Add the new head to the beginning of the snake array
            snake.unshift(head);

            // Check if the snake ate the food
            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreElement.innerText = score;
                food = generateFood();
                // Speed up the game
                gameSpeed = Math.max(50, gameSpeed - SPEED_INCREMENT);
                // Restart the game loop with the new speed
                clearInterval(gameLoop);
                gameLoop = setInterval(update, gameSpeed);
            } else {
                // If not, remove the tail to simulate movement
                snake.pop();
            }

            render();
        }

        // Render the game state to the canvas
        function render() {
            // Clear the canvas
            ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

            // Draw the food
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(food.x * CELL_SIZE, food.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
            
            // Draw the snake
            snake.forEach((segment, index) => {
                ctx.fillStyle = index === 0 ? '#1abc9c' : '#16a085'; // Head is a different color
                ctx.fillRect(segment.x * CELL_SIZE, segment.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                ctx.strokeStyle = '#2c3e50'; // Border for segments
                ctx.strokeRect(segment.x * CELL_SIZE, segment.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
            });
        }

        // End the game and display a message
        function endGame() {
            isGameOver = true;
            isGameStarted = false;
            clearInterval(gameLoop);
            startButton.innerText = 'Spela igen';
            alertMessage('Game Over!', `Dina poäng: ${score}`);
        }

        // Custom alert function since window.alert() is blocked
        function alertMessage(title, message) {
            const container = document.getElementById('game-container');
            let messageBox = document.getElementById('messageBox');
            
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'messageBox';
                messageBox.style.cssText = `
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: rgba(44, 62, 80, 0.95);
                    color: #ecf0f1;
                    padding: 30px;
                    border-radius: 15px;
                    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
                    text-align: center;
                    z-index: 1000;
                    width: 80%;
                    max-width: 300px;
                    display: none;
                `;
                container.appendChild(messageBox);
            }
            
            messageBox.innerHTML = `
                <h2>${title}</h2>
                <p>${message}</p>
            `;
            messageBox.style.display = 'block';

            // Hide the message box on the next game start
            startButton.addEventListener('click', () => {
                messageBox.style.display = 'none';
            }, { once: true });
        }


        // --- Event Listeners and Game Initialization ---

        // Handle keyboard input for snake direction
        function handleKeydown(event) {
            if (!isGameStarted || isGameOver) return;
            
            const key = event.key;
            const newDirection = { ...direction }; // Create a copy to avoid immediate change

            switch (key) {
                case 'ArrowUp':
                    if (direction.y !== 1) newDirection.x = 0, newDirection.y = -1;
                    break;
                case 'ArrowDown':
                    if (direction.y !== -1) newDirection.x = 0, newDirection.y = 1;
                    break;
                case 'ArrowLeft':
                    if (direction.x !== 1) newDirection.x = -1, newDirection.y = 0;
                    break;
                case 'ArrowRight':
                    if (direction.x !== -1) newDirection.x = 1, newDirection.y = 0;
                    break;
            }
            direction = newDirection;
        }

        // Start button handler
        startButton.addEventListener('click', () => {
            if (!isGameStarted) {
                isGameStarted = true;
                initializeGame();
                startButton.innerText = 'Spelar...';
                gameLoop = setInterval(update, gameSpeed);
            }
        });

        // Add event listener for keyboard input
        document.addEventListener('keydown', handleKeydown);

        // Initial setup on window load
        window.onload = function() {
            initializeGame();
        };

    </script>
</body>
</html>
